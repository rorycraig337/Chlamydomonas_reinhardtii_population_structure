##pipeline to call admixed windows between NA1 and NA2 based on consensus marker SNPs in each clade

#create consensus file of SNPs, using SNPs masked for IBD tracts and filtered for minimum number of isolates per clade
perl fasta2consensus.pl --clade1 NA1.txt --clade2 NA2.txt --fasta $PATH/snps.IBD_masked.min_isolates.fa --percentage 60 --out consensus.txt

#pull out good markers (consensus base is different between clades)
perl filter_identical.pl --in consensus.txt --out consensus_polymorphic.txt

#add genomic positions to markers 
perl add_genomic_positions.pl --vcf $PATH/snps.IBD_masked.min_isolates.vcf --snps consensus_polymorphic.txt --out f_consensus_polymorphic.txt

#get percentage of opposite clade SNPs for each isolate per 20 kb window
#use non-IBD masked SNPs here as percentages are unique to isolates
perl tally_marker_snps.pl --cladeA NA1.txt --cladeB NA2.txt --bed 20kb_windows.bed --vcf $PATH/snps.min_isolates.vcf --in f_consensus_polymorphic.txt --out 20kb.introgression.tsv
sort -k1,1 -k2n,2n 20kb.introgression.tsv > s_20kb.introgression.tsv

#fill in missing windows (those that had no markers)
perl fill_missing_windows.pl --windows 20kb_windows.bed --admixture s_20kb.introgression.tsv --isolates #isolates --out f_20kb.introgression.tsv

#format data for R
perl format_admixture_for_R_values.pl --isolates all_info.txt --in f_20kb.introgression.tsv --out 20kb.R.tsv
perl format_admixture_for_R_heat.pl --isolates all.txt --isolates_new all_phylo.txt --in 20kb.R.tsv --suffix 20kb.R.csv

#next step on how to combine windows into haplotypes, 20kb with 4kb slide, then merge windows that begin >60% until they drop <40%?
